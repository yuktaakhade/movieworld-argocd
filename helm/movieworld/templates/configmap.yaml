apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "movieworld.fullname" . }}-config
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "movieworld.labels" . | nindent 4 }}
data:
  application.properties: |
    # Database Configuration
    spring.datasource.url={{ .Values.database.url }}
    spring.jpa.hibernate.ddl-auto=update
    spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
    
    # Service URLs
    moviereview.service.url={{ .Values.services.moviereview.url }}
    
    # Actuator Configuration
    management.endpoints.web.exposure.include=health,info,metrics,prometheus,loggers
    management.endpoint.health.show-details=always
    management.endpoint.loggers.enabled=true
    management.endpoint.metrics.enabled=true
    management.endpoint.prometheus.enabled=true
    management.metrics.distribution.percentiles-histogram.http.server.requests=true
    
    # OpenTelemetry Configuration
    otel.sdk.disabled={{ not .Values.opentelemetry.enabled }}
    otel.exporter.otlp.endpoint={{ .Values.opentelemetry.endpoint }}
    otel.metrics.exporter={{ .Values.opentelemetry.metricsExporter }}
    otel.logs.exporter={{ .Values.opentelemetry.logsExporter }}
    otel.propagators={{ .Values.opentelemetry.propagators }}
    
    # Logging Configuration
    logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]
  
  database-url: {{ .Values.database.url }}
  moviereview-service-url: {{ .Values.services.moviereview.url }}
